# npki-html5-loader

맥에서 별도의 프로그램 설치 없이 html5 으로 공인인증서를 불러오는 데모입니다.

## Backgrounds

왜 공인인증서 프로그램이 필요했나? 공인인증서 없이 안 되나?

* 공인인증서 관련 정보는 인터넷 검색과 리버싱을 통해서 알아낸 정보이며, 가장 정확한 정보는 [KISA 홈페이지](https://www.rootca.or.kr/kor/accredited/accredited06_01.jsp)에서 확인해야 합니다. 너무 길고 복잡해서 다 읽지 못했...

### 공인인증서 프로그램의 역할

공인인증서를 발급 받으면 아래처럼 로컬 컴퓨터에 저장됩니다.

```etc
/Users/[username]/Library/Preferences/NPKI
└───yessign // 공인인증기관
│   └───USER
│   │   └───cn=홍길동()xxx1043xxx801xxx810xxx61,ou=HNB,ou=personalXXX,o=yessign,c=kr // 공인인증서
│   │   │   │   signCert.der // 인증서 정보
│   │   │   │   signPri.key // 인증서 키
│   │   │
│   │   └───cn=홍길동()xxx1043xxx801xxx810xxx61,ou=HNB,ou=personalXXX,o=yessign,c=kr // 공인인증서
│   │   │   │   signCert.der // 인증서 정보
│   │   │   │   signPri.key // 인증서 키
│   │   │
│   │   ...
│   │
│   ...
```

공인인증서 프로그램은 이 경로에 있는 파일들을 읽어 인증서 목록에 보여주고, 필요한 곳으로 업로드하는 역할을 합니다.

### 프로그램이 필요한 이유

브라우저에서의 javascript 는 샌드박스 형태로 작동하기 때문에 로컬 파일 시스템에 접근할 수 없습니다. 국내에서 사용되는 공인인증서 체계에서는 공인인증서를 파일시스템(하드디스크, USB 등)에 저장하기 때문에 브라우저가 스스로 이 공인인증서에 접근할 수 있는 방법이 없었습니다. 그래서 파일시스템에 접근하기 위한 별도의 프로그램(.exe, .dmg)이나 ActiveX, Flash, Silverlight 등의 플러그인이 필요하게 되었습니다.

최근에는 ActiveX 폐지가 진행되면서 `html5`만으로 직접 접근이 가능한 형태의 브라우저 인증서 스펙이 제안되었고[^1], 몇몇 금융 기관들이 도입하고 있습니다[^2]. 하지만 아직 많은 유저들이 로컬 파일시스템에 저장하는 공인인증서를 사용하고 있기 때문에 당분간은 두 방식 모두 지원할 수밖에 없습니다.

e.g. [html5 기반 인증서 솔루션 업체](http://www.yettiesoft.com/sub3.jsp)

## 대안: 프로그램 설치 없이 공인인증서 읽기

가능한 방법은 두 가지입니다.

1.  html5 에서 `<input>` 엘리먼트를 통해 공인인증서 파일 읽기

    * html5 파일시스템에 직접 접근할 수 있는 유일한 방법은 `<input>` 엘리먼트를 이용해서 유저가 직접 파일의 위치를 브라우저에게 알려주게 하는 것입니다.
    * 그러나 유저에게 공인인증서의 위치(`/Users/[username]/Library/Preferences/NPKI`)를 찾게 하는 건 어려운 일입니다.
    * 한 가지 방법은 `file://`로 시작하는 형식의 File Link 를 이용해서 NPKI 디렉토리가 바로 보이도록 Finder 앱을 열어주고, 폴더를 브라우저로 드래그하게 하는 것입니다.
    * 하지만 공인인증서 경로에 `[username]`이 들어가기 때문에 username 을 어떻게 알아낼지 (혹은 쉽게 입력받을지) 더 고민해야 합니다.

    * Q1: 유저에게 입력받지 않고 `[username]`을 알 수 있는 방법이 있을까? (File Link 에 unix 의 `~/`같은 keyword 는 없을까?)

2.  터미널 앱을 이용하여 공인인증서 파일 업로드 하기

    * 다른 방법은 맥의 기본 프로그램을 이용해서 브라우저 외부에서 파일에 접근하는 것입니다.
    * 유저에게 터미널 앱을 실행하게 해서 지정된 명령어를 복붙하여 실행하게 합니다.
    * 다만, 터미널은 GUI 를 제공할 수 없기 때문에 조작이 어렵다는 치명적인 단점이 있습니다.

    * Q1: 터미널에서 또 다른 기본 프로그램을 활용해서 GUI 를 보여줄 수 있는 방법은 없을까?
    * Q2: GUI 가 아예 필요 없이, 성공 실패 여부만 보여줘도 되게 공인인증서 선택 Flow 를 단순화 할 수 있을까?

3.  브라우저 확장 프로그램 이용하기
    * 파일시스템 접근 권한이 있는 Safari 나 Chrome 의 확장프로그램을 제작합니다.
    * 프로그램을 설치하는 것보다 조금 더 간단하지만, 결국 프로그램을 설치하는 것입니다(...).
    * 브라우저 별로 확장프로그램을 제작해야 하는 문제도 있습니다.

## 대안 비교

1, 2 번 대안은 유저의 도움을 받아야하고 일반적인 경험이 아닌 점에서 프로그램보다 경험이 더 좋다고 하기 어렵습니다.

3 번은 공인이증서 프로그램을 설치하는 것보다는 쉽지만 결국 확장 프로그램을 설치해야 합니다. 확장 프로그램을 직접 개발해야하기 때문에 어떤 문제가 기다리고 있을지 알 수 없습니다.

## 결론

공인인증서가 웹에서 접근이 불가능한 곳에 저장되기 때문에 결국 html5 만으로 공인인증서 기능을 쓰려면 프로그램을 설치하거나 브라우저 인증서를 사용해야 합니다. 프로그램을 설치하지 않고 최대한 쉬운 경험을 주는 대안을 찾아보려 했으나 각각의 대안들이 단점을 가지고 있고 기존의 방식보다 더 낫다고 하기 어렵기 때문에, 단점을 커버할 수 있는 아이디어가 없다면 실현하기 어려운 대안들이라고 생각됩니다.

[^1]: http://www.ddaily.co.kr/news/article.html?no=122409
[^2]: http://biz.khan.co.kr/khan_art_view.html?artid=201509011345261&code=920301
